{
    "componentChunkName": "component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx",
    "path": "/react-query-data-transformations",
    "result": {"data":{"post":{"slug":"/react-query-data-transformations","title":"React Query Data Transformations","date":"10.03.2021","tags":[{"name":"react","slug":"react"},{"name":"react-query","slug":"react-query"},{"name":"JavaScript","slug":"java-script"},{"name":"TypeScript","slug":"type-script"}],"description":"Learn the possibilities to perform the quite common and important task of transforming your data with react-query","canonicalUrl":null,"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"React Query Data Transformations\",\n  \"description\": \"Learn the possibilities to perform the quite common and important task of transforming your data with react-query\",\n  \"date\": \"2021-03-10T00:00:00.000Z\",\n  \"banner\": \"./transformations.jpeg\",\n  \"tags\": [\"react\", \"react-query\", \"JavaScript\", \"TypeScript\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"span\", {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"640px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"66.66666666666666%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAFwABAQEBAAAAAAAAAAAAAAAAAwABBf/EABUBAQEAAAAAAAAAAAAAAAAAAAIB/9oADAMBAAIQAxAAAAHlKOBBNKf/xAAaEAADAQADAAAAAAAAAAAAAAAAAQIRAxIh/9oACAEBAAEFAi568fgnhTdGI//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/AUf/xAAVEQEBAAAAAAAAAAAAAAAAAAAQEf/aAAgBAgEBPwGH/8QAGBAAAgMAAAAAAAAAAAAAAAAAECEAMUH/2gAIAQEABj8Cj2ix/8QAHBABAAIBBQAAAAAAAAAAAAAAAQARITFBUXGB/9oACAEBAAE/IUKxiWyxpHqMNnuO27jSYdOZ/9oADAMBAAIAAwAAABBr7//EABYRAQEBAAAAAAAAAAAAAAAAABEBEP/aAAgBAwEBPxBhj//EABURAQEAAAAAAAAAAAAAAAAAABEA/9oACAECAQE/EEzf/8QAHRABAQABBAMAAAAAAAAAAAAAAREAITFRYUFx0f/aAAgBAQABPxANHjBsy9IBHm/MA7reoZFB6FwilBDgOsFuzq5Of//Z')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"transformations\",\n    \"title\": \"transformations\",\n    \"src\": \"/blog/static/8dcd594d239f514bb0b7058364c3740b/bbe0c/transformations.jpg\",\n    \"srcSet\": [\"/blog/static/8dcd594d239f514bb0b7058364c3740b/46946/transformations.jpg 240w\", \"/blog/static/8dcd594d239f514bb0b7058364c3740b/55489/transformations.jpg 480w\", \"/blog/static/8dcd594d239f514bb0b7058364c3740b/bbe0c/transformations.jpg 640w\"],\n    \"sizes\": \"(max-width: 640px) 100vw, 640px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \"), mdx(Attribution, {\n    name: \"Joshua Sukoff\",\n    url: \"https://unsplash.com/@joshuas\",\n    mdxType: \"Attribution\"\n  }), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"practical-react-query\"\n  }, \"#1: Practical React Query\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"b\", null, \"#2: React Query Data Transformations\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"react-query-render-optimizations\"\n  }, \"#3: React Query Render Optimizations\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"status-checks-in-react-query\"\n  }, \"#4: Status Checks in React Query\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"testing-react-query\"\n  }, \"#5: Testing React Query\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"react-query-and-type-script\"\n  }, \"#6: React Query and TypeScript\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"using-web-sockets-with-react-query\"\n  }, \"#7: Using WebSockets with React Query\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"effective-react-query-keys\"\n  }, \"#8: Effective React Query Keys\"), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"leveraging-the-query-function-context\"\n  }, \"#8a: Leveraging the Query Function Context\")))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"placeholder-and-initial-data-in-react-query\"\n  }, \"#9: Placeholder and Initial Data in React Query\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"react-query-as-a-state-manager\"\n  }, \"#10: React Query as a State Manager\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"react-query-error-handling\"\n  }, \"#11: React Query Error Handling\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"mastering-mutations-in-react-query\"\n  }, \"#12: Mastering Mutations in React Query\"))), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"Welcome to Part 2 of \\\"Things I have to say about react-query\\\". As I've become more and more involved with the library and the community around it, I've observed some more patterns people frequently ask about. Initially, I wanted to write them all down in one big article, but then decided to break them down into more manageable pieces. The first one is about a quite common and important task: Data Transformation.\"), mdx(\"h2\", {\n    \"id\": \"data-transformation\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Data Transformation\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#data-transformation\",\n    \"aria-label\": \"data transformation permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"Let's face it - most of us are \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"not\"), \" using GraphQL. If you do, then you can be very happy because you have the luxury of requesting your data in the format that you desire.\"), mdx(\"p\", null, \"If you are working with REST though, you are constrained by what the backend returns. So how and where do you best transform data when working with react-query? The only answer worth a damn in software development applies here as well:\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"It depends.\")), mdx(\"p\", {\n    style: {\n      \"paddingLeft\": \"3rem\",\n      \"marginTop\": \"-1rem\"\n    }\n  }, \"\\u2014 Every developer, always\"), mdx(\"p\", null, \"Here are 3+1 approaches on where you \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"can\"), \" transform data with their respective pros and cons:\"), mdx(\"h3\", {\n    \"id\": \"0-on-the-backend\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"0. On the backend\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#0-on-the-backend\",\n    \"aria-label\": \"0 on the backend permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"This is my favourite approach, if you can afford it. If the backend returns data in exactly the structure we want, there is nothing we need to do. While this might sound unrealistic in many cases, e.g. when working with public REST APIs, it is also quite possible to achieve in enterprise applications. If you are in control of the backend and have an endpoint that returns data for your exact use-case, prefer to deliver the data the way you expect it.\"), mdx(\"p\", null, \"\\uD83D\\uDFE2 \", \"\\xA0\", \" no work on the frontend\", mdx(\"br\", null), \"\\n\\uD83D\\uDD34 \", \"\\xA0\", \" not always possible\"), mdx(\"h3\", {\n    \"id\": \"1-in-the-queryfn\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"1. In the queryFn\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#1-in-the-queryfn\",\n    \"aria-label\": \"1 in the queryfn permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"The \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"queryFn\"), \" is the function that you pass to \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"useQuery\"), \". It expects you to return a Promise, and the resulting data winds up in the query cache. But it doesn't mean that you have to absolutely return data in the structure that the backend delivers here. You can transform it before doing so:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts:title=queryFn-transformation\"\n  }, \"const fetchTodos = async (): Promise<Todos> => {\\n  const response = await axios.get('todos')\\n  const data: Todos = response.data\\n\\n  return data.map((todo) => todo.name.toUpperCase())\\n}\\n\\nexport const useTodosQuery = () => useQuery(['todos'], fetchTodos)\\n\")), mdx(\"p\", null, \"On the frontend, you can then work with this data \\\"as if it came like this from the backend\\\". No where in your code will you actually work with todo names that are \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"not\"), \" upper-cased. You will also \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"not\"), \" have access to the original structure. If you look at the react-query-devtools, you will see the transformed structure. If you look at the network trace, you'll see the original structure. This might be confusing, so keep that in mind.\"), mdx(\"p\", null, \"Also, there is no optimization that react-query can do for you here. Every time a fetch is executed, your transformation will run. If it's expensive, consider one of the other alternatives. Some companies also have a shared api layer that abstracts data fetching, so you might not have access to this layer to do your transformations.\"), mdx(\"p\", null, \"\\uD83D\\uDFE2 \", \"\\xA0\", \" very \\\"close to the backend\\\" in terms of co-location\", mdx(\"br\", null), \"\\n\\uD83D\\uDFE1 \", \"\\xA0\", \" the transformed structure winds up in the cache, so you don't have access to the original structure\", mdx(\"br\", null), \"\\n\\uD83D\\uDD34 \", \"\\xA0\", \" runs on every fetch\", mdx(\"br\", null), \"\\n\\uD83D\\uDD34 \", \"\\xA0\", \" not feasible if you have a shared api layer that you cannot freely modify\"), mdx(\"h3\", {\n    \"id\": \"2-in-the-render-function\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"2. In the render function\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#2-in-the-render-function\",\n    \"aria-label\": \"2 in the render function permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"As advised in \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"practical-react-query\"\n  }, \"Part 1\"), \", if you create custom hooks, you can easily do transformations there:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts:title=render-transformation\"\n  }, \"const fetchTodos = async (): Promise<Todos> => {\\n  const response = await axios.get('todos')\\n  return response.data\\n}\\n\\nexport const useTodosQuery = () => {\\n  const queryInfo = useQuery(['todos'], fetchTodos)\\n\\n  return {\\n    ...queryInfo,\\n    data: queryInfo.data?.map((todo) => todo.name.toUpperCase()),\\n  }\\n}\\n\")), mdx(\"p\", null, \"As it stands, this will not only run every time your fetch function runs, but actually on every render (even those that do not involve data fetching). This is likely not a problem at all, but if it is, you can optimize with \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"useMemo\"), \". Be careful to define your dependencies \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"as narrow as possible\"), \". \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"data\"), \" inside the queryInfo will be referentially stable unless something really changed (in which case you want to recompute your transformation), but the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"queryInfo\"), \" itself will \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"not\"), \". If you add \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"queryInfo\"), \" as your dependency, the transformation will again run on every render:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts:title=useMemo-dependencies\"\n  }, \"export const useTodosQuery = () => {\\n  const queryInfo = useQuery(['todos'], fetchTodos)\\n\\n  return {\\n    ...queryInfo,\\n    // \\uD83D\\uDEA8 don't do this - the useMemo does nothing at all here!\\n    data: React.useMemo(\\n      () => queryInfo.data?.map((todo) => todo.name.toUpperCase()),\\n      [queryInfo]\\n    ),\\n\\n    // \\u2705 correctly memoizes by queryInfo.data\\n    data: React.useMemo(\\n      () => queryInfo.data?.map((todo) => todo.name.toUpperCase()),\\n      [queryInfo.data]\\n    ),\\n  }\\n}\\n\")), mdx(\"p\", null, \"Especially if you have additional logic in your custom hook to combine with your data transformation, this is a good option. Be aware that data can be potentially undefined, so use optional chaining when working with it.\"), mdx(\"p\", null, \"\\uD83D\\uDFE2 \", \"\\xA0\", \" optimizable via useMemo\", mdx(\"br\", null), \"\\n\\uD83D\\uDFE1 \", \"\\xA0\", \" exact structure cannot be inspected in the devtools\", mdx(\"br\", null), \"\\n\\uD83D\\uDD34 \", \"\\xA0\", \" a bit more convoluted syntax\", mdx(\"br\", null), \"\\n\\uD83D\\uDD34 \", \"\\xA0\", \" data can be potentially undefined\", mdx(\"br\", null)), mdx(\"h3\", {\n    \"id\": \"3-using-the-select-option\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"3. using the select option\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#3-using-the-select-option\",\n    \"aria-label\": \"3 using the select option permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"v3 introduced built-in selectors, which can also be used to transform data:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts:title=select-transformation\"\n  }, \"export const useTodosQuery = () =>\\n  useQuery(['todos'], fetchTodos, {\\n    select: (data) => data.map((todo) => todo.name.toUpperCase()),\\n  })\\n\")), mdx(\"p\", null, \"selectors will only be called if \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"data\"), \" exists, so you don't have to care about \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"undefined\"), \" here. Selectors like the one above will also run on every render, because the functional identity changes (it's an inline function). If your transformation is expensive, you can memoize it either with useCallback, or by extracting it to a stable function reference:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts:title=select-memoizations\"\n  }, \"const transformTodoNames = (data: Todos) =>\\n  data.map((todo) => todo.name.toUpperCase())\\n\\nexport const useTodosQuery = () =>\\n  useQuery(['todos'], fetchTodos, {\\n    // \\u2705 uses a stable function reference\\n    select: transformTodoNames,\\n  })\\n\\nexport const useTodosQuery = () =>\\n  useQuery(['todos'], fetchTodos, {\\n    // \\u2705 memoizes with useCallback\\n    select: React.useCallback(\\n      (data: Todos) => data.map((todo) => todo.name.toUpperCase()),\\n      []\\n    ),\\n  })\\n\")), mdx(\"p\", null, \"Further, the select option can also be used to subscribe to only parts of the data. This is what makes this approach truly unique. Consider the following example:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js:title=select-partial-subscriptions\"\n  }, \"export const useTodosQuery = (select) =>\\n  useQuery(['todos'], fetchTodos, { select })\\n\\nexport const useTodosCount = () => useTodosQuery((data) => data.length)\\nexport const useTodo = (id) =>\\n  useTodosQuery((data) => data.find((todo) => todo.id === id))\\n\")), mdx(\"p\", null, \"Here, we've created a \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://react-redux.js.org/api/hooks#useselector\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"useSelector\"), \" like API by passing a custom selector to our \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"useTodosQuery\"), \". The custom hooks still works like before, as \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"select\"), \" will be \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"undefined\"), \" if you don't pass it, so the whole state will be returned.\"), mdx(\"p\", null, \"But if you pass a selector, you are now only subscribed to the result of the selector function. This is quite powerful, because it means that even if we update the name of a todo, our component that only subscribes to the count via \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"useTodosCount\"), \" will \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"not\"), \" rerender. The count hasn't changed, so react-query can choose to \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"not\"), \" inform this observer about the update \\uD83E\\uDD73 (Please note that this is a bit simplified here and technically not entirely true - I will talk in more detail about render optimizations in Part 3).\"), mdx(\"p\", null, \"\\uD83D\\uDFE2 \", \"\\xA0\", \" best optimizations\", mdx(\"br\", null), \"\\n\\uD83D\\uDFE2 \", \"\\xA0\", \" allows for partial subscriptions\", mdx(\"br\", null), \"\\n\\uD83D\\uDFE1 \", \"\\xA0\", \" structure can be different for every observer\", mdx(\"br\", null), \"\\n\\uD83D\\uDFE1 \", \"\\xA0\", \" structural sharing is performed twice (I will also talk about this in more detail in Part 3)\"), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"That's all I have for today \\uD83D\\uDC4B. Feel free to reach out to me on \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://twitter.com/tkdodo\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"twitter\"), \"\\nif you have any questions, or just leave a comment below \\u2B07\\uFE0F\"), mdx(Comments, {\n    withSeparator: false,\n    mdxType: \"Comments\"\n  }));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"#1: Practical React Query #3: React Query Render Optimizations #4: Status Checks in React Query #5: Testing React Query #6: React Query andâ€¦","timeToRead":4,"banner":{"childImageSharp":{"resize":{"src":"/static/8dcd594d239f514bb0b7058364c3740b/a6c62/transformations.jpg"}}}}},"pageContext":{"slug":"/react-query-data-transformations","formatString":"DD.MM.YYYY"}},
    "staticQueryHashes": ["2744905544","3090400250","318001574"]}