{
    "componentChunkName": "component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx",
    "path": "/practical-react-query",
    "result": {"data":{"post":{"slug":"/practical-react-query","title":"Practical React Query","date":"16.11.2020","tags":[{"name":"react","slug":"react"},{"name":"react-query","slug":"react-query"}],"description":"Let me share with you the experiences I have made lately with React Query. Fetching data in React has never been this delightful...","canonicalUrl":null,"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Practical React Query\",\n  \"description\": \"Let me share with you the experiences I have made lately with React Query. Fetching data in React has never been this delightful...\",\n  \"date\": \"2020-11-16T00:00:00.000Z\",\n  \"banner\": \"./react-query.png\",\n  \"tags\": [\"react\", \"react-query\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"span\", {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"33.75%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABaElEQVQoz2WNTUsbYRSF76SLgiCKRSRmYvNhkolGJxnUJtbMJM6gUShts4gKoohCYgXddZNA6aZivwRBFAVBwf/gL3Djj3pk8hKMung49z3n3vOKpFw6BAwXzZ99TXt0Z2J4aIbX1mf+SyRRQuEgcQcZ9dVGIh/V7GejNhIrItE5lSVLKuvk3UjcX5qjP2GzZy3gjpV5m/GIlWptXyIFAgmbvmyFYOEzPRkP0Wfa2ZukjUT9j4t0eiQQLSCRD1SNMlc7Ff67JSqLm9zdP/Dr9JqfJ1c0/57TaP3mx/Elfy5uaf274PDshnrziOLKLhK00OKziN+lvZ9GRqbQY3m+511qE0V60w75L1s4tTrza98orzZIOFVyy+tUNvZZ2jxg6tMGs9Vt4vZXJGiiRWYQv0vCFoocErIQ3UJCWeRdWjFgKB2aQAbH1XsgpbzgJDJs8tRhIRKa5DUmgXD2GZpuor3wRDfbu923j8L/1jSwmqJdAAAAAElFTkSuQmCC')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"react query\",\n    \"title\": \"react query\",\n    \"src\": \"/blog/static/e34c9bdb709f49c90b76af647160ca18/7d769/react-query.png\",\n    \"srcSet\": [\"/blog/static/e34c9bdb709f49c90b76af647160ca18/5243c/react-query.png 240w\", \"/blog/static/e34c9bdb709f49c90b76af647160ca18/ab158/react-query.png 480w\", \"/blog/static/e34c9bdb709f49c90b76af647160ca18/7d769/react-query.png 960w\", \"/blog/static/e34c9bdb709f49c90b76af647160ca18/d2835/react-query.png 1279w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \"), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"b\", null, \"#1: Practical React Query\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"react-query-data-transformations\"\n  }, \"#2: React Query Data Transformations\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"react-query-render-optimizations\"\n  }, \"#3: React Query Render Optimizations\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"status-checks-in-react-query\"\n  }, \"#4: Status Checks in React Query\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"testing-react-query\"\n  }, \"#5: Testing React Query\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"react-query-and-type-script\"\n  }, \"#6: React Query and TypeScript\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"using-web-sockets-with-react-query\"\n  }, \"#7: Using WebSockets with React Query\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"effective-react-query-keys\"\n  }, \"#8: Effective React Query Keys\"), mdx(\"ul\", {\n    parentName: \"li\"\n  }, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"leveraging-the-query-function-context\"\n  }, \"#8a: Leveraging the Query Function Context\")))), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"placeholder-and-initial-data-in-react-query\"\n  }, \"#9: Placeholder and Initial Data in React Query\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"react-query-as-a-state-manager\"\n  }, \"#10: React Query as a State Manager\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"react-query-error-handling\"\n  }, \"#11: React Query Error Handling\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"mastering-mutations-in-react-query\"\n  }, \"#12: Mastering Mutations in React Query\"))), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"When GraphQL and especially \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.apollographql.com/docs/react/\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"Apollo Client\"), \"\\nbecame popular in ca. 2018, there was a lot of fuss about it completely replacing redux, and the question\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://dev.to/markerikson/redux---not-dead-yet-1d9k\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"Is Redux dead yet?\"), \" has been asked a lot.\"), mdx(\"p\", null, \"I distinctly remember not understanding what this was all about.\\nWhy would some data fetching library replace your global state manager? What does one even have to do with the other?\"), mdx(\"p\", null, \"I was under the impression that GraphQL clients like Apollo would only fetch the data for you,\\nsimilar to what e.g. \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/axios/axios\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"axios\"), \" does for REST,\\nand that you would still obviously need some way of making that data accessible to your application.\"), mdx(\"p\", null, \"I couldn't have been more wrong.\"), mdx(\"h2\", {\n    \"id\": \"client-state-vs-server-state\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Client State vs. Server State\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#client-state-vs-server-state\",\n    \"aria-label\": \"client state vs server state permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"What Apollo gives you is not just the ability to describe which data you want and to fetch that data,\\nit also comes with a \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"cache\"), \" for that server data.\\nThis means that you can just use the same \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"useQuery\"), \" hook in multiple components,\\nand it will only fetch data once and then subsequently return it from the cache.\"), mdx(\"p\", null, \"This sounds \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"very\"), \" familiar with what we, and probably many other teams as well, have mainly been using \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"redux\"), \" for:\\nFetch data from the server and make it available everywhere.\"), mdx(\"p\", null, \"So it seems that we have always been treating this \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"server state\"), \" like any other \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"client state\"), \".\\nExcept that when it comes to \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"server state\"), \" (think: A list of articles that you fetch,\\nthe details of a User you want to display, ...), your app does not own it.\\nWe have only borrowed it to display the most recent version of it on the screen for the user.\\nIt is the server who owns the data.\"), mdx(\"p\", null, \"To me, that introduced a paradigm shift in how to think about data.\\nIf we can leverage the cache to display data that we do not own,\\nthere isn't really much left that is real client state that \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"also\"), \" needs to be made available to the whole app.\\nThat made me understand why many think that Apollo can replace redux in lots of instances.\"), mdx(\"h2\", {\n    \"id\": \"react-query\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"React Query\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#react-query\",\n    \"aria-label\": \"react query permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"I have never had the chance to use GraphQL.\\nWe have an existing REST API, don't really experience problems with over-fetching, it just works, etc.\\nClearly, there aren't enough pain points for us to warrant a switch,\\nespecially given that you'd also have to adapt the backend, which isn't quite so simple.\"), mdx(\"p\", null, \"Yet I still envied the simplicity of how data fetching can look like on the frontend,\\nincluding the handling of loading and error states. If only there were something similar in React for REST APIs...\"), mdx(\"p\", null, \"Enter \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://react-query.tanstack.com/\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"React Query\"), \".\"), mdx(\"p\", null, \"Made by the open sourcerer \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://github.com/tannerlinsley\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"Tanner Linsley\"), \" in late 2019,\\nReact Query takes the good parts of Apollo and brings them to REST.\\nIt works with any function that returns a Promise and embraces the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"stale-while-revalidate\"), \" caching strategy.\\nThe library operates on sane defaults that try to keep your data as fresh as possible\\nwhile at the same time showing data to the user as early as possible,\\nmaking it feel near instant at times and thus providing a great UX.\\nOn top of that, it is also very flexible and lets you customize various settings for when the defaults are not enough.\"), mdx(\"p\", null, \"This article is not going to be an introduction to React Query though.\"), mdx(\"p\", null, \"I think the docs are great at explaining Guides & Concepts,\\nthere are \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://react-query.tanstack.com/docs/videos\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"Videos\"), \" from various Talks that you can watch,\\nand Tanner has a React Query \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://learn.tanstack.com/\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"Essentials Course\"), \" you can take if you want to get familiar with the library.\"), mdx(\"p\", null, \"I want to focus more on some practical tips that go beyond the docs, which might be useful when you are already working with the library.\\nThese are things I have picked up over the last couple of months when I was not only actively using the library at work,\\nbut also got involved in the React Query community, answering questions on Discord and in GitHub Discussions.\"), mdx(\"h3\", {\n    \"id\": \"the-defaults-explained\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"The Defaults explained\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#the-defaults-explained\",\n    \"aria-label\": \"the defaults explained permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"I believe the React Query \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://react-query.tanstack.com/docs/guides/important-defaults\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"Defaults\"), \"\\nare very well chosen, but they can catch you off guard from time to time, especially at the beginning.\"), mdx(\"p\", null, \"First of all: React Query does \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"not\"), \" invoke the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"queryFn\"), \" on every re-render, even with the default \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"staleTime\"), \" of zero.\\nYour app can re-render for various reasons at any time, so fetching every time would be insane!\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Always code for re-renders, and a lot of them. I like to call it render resiliency.\")), mdx(\"p\", {\n    style: {\n      \"paddingLeft\": \"3rem\",\n      \"marginTop\": \"-1rem\"\n    }\n  }, \"\\u2014 Tanner Linsley\"), mdx(\"p\", null, \"If you see a refetch that you are not expecting, it is likely because you just focused the window\\nand React Query is doing a \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"refetchOnWindowFocus\"), \", which is a great feature for production:\\nIf the user goes to a different browser tab, and then comes back to your app,\\na background refetch will be triggered automatically,\\nand data on the screen will be updated if something has changed on the server in the meantime.\\nAll of this happens without a loading spinner being shown,\\nand your component will not re-render if the data is the same as you currently have in the cache.\"), mdx(\"p\", null, \"During development, this will probably be triggered more frequently,\\nespecially because focusing between the Browser DevTools and your app will also cause a fetch, so be aware of that.\"), mdx(\"p\", null, \"Secondly, there seems to be a bit of confusion between \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"cacheTime\"), \" and \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"staleTime\"), \", so let me try to clear that up:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"StaleTime: The duration until a query transitions from fresh to stale.\\nAs long as the query is fresh, data will always be read from the cache only - no network request will happen!\\nIf the query is stale (which per default is: instantly), you will still get data from the cache,\\nbut a background refetch can happen \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://react-query.tanstack.com/docs/guides/caching\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"under certain conditions\"), \".\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"CacheTime: The duration until inactive queries will be removed from the cache. This defaults to 5 minutes.\\nQueries transition to the inactive state as soon as there are no observers registered,\\nso when all components which use that query have unmounted.\")), mdx(\"p\", null, \"Most of the time, if you want to change one of these settings, it's the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"staleTime\"), \" that needs adjusting.\\nI have rarely ever needed to tamper with the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"cacheTime\"), \".\\nThere is a good \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://react-query.tanstack.com/docs/guides/caching#a-detailed-caching-example\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"explanation by example\"), \"\\nin the docs as well.\"), mdx(\"h3\", {\n    \"id\": \"use-the-react-query-devtools\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Use the React Query DevTools\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#use-the-react-query-devtools\",\n    \"aria-label\": \"use the react query devtools permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"This will help you immensely in understanding the state a query is in.\\nThe DevTools will also tell you what data is currently in the cache, so you'll have an easier time debugging.\\nIn addition to that, I have found that it helps to throttle your network connection in the browser DevTools\\nif you want to better recognize background refetches, since dev-servers are usually pretty fast.\"), mdx(\"h3\", {\n    \"id\": \"treat-the-query-key-like-a-dependency-array\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Treat the query key like a dependency array\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#treat-the-query-key-like-a-dependency-array\",\n    \"aria-label\": \"treat the query key like a dependency array permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"I am referring to the dependency array of the\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://reactjs.org/docs/hooks-reference.html#conditionally-firing-an-effect\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"useEffect\"), \" hook here,\\nwhich I assume you are familiar with.\"), mdx(\"p\", null, \"Why are these two similar?\"), mdx(\"p\", null, \"Because React Query will trigger a refetch whenever the query key changes.\\nSo when we pass a variable parameter to our \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"queryFn\"), \", we almost always want to fetch data when that value changes.\\nInstead of orchestrating complex effects to manually trigger a refetch, we can utilize the query key:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts:title=feature/todos/queries.ts\"\n  }, \"type State = 'all' | 'open' | 'done'\\ntype Todo = {\\n  id: number\\n  state: State\\n}\\ntype Todos = ReadonlyArray<Todo>\\n\\nconst fetchTodos = async (state: State): Promise<Todos> => {\\n  const response = await axios.get(`todos/${state}`)\\n  return response.data\\n}\\n\\nexport const useTodosQuery = (state: State) =>\\n  useQuery(['todos', state], () => fetchTodos(state))\\n\")), mdx(\"p\", null, \"Here, imagine that our UI displays a list of todos along with a filter option.\\nWe would have some local state to store that filtering,\\nand as soon as the user changes their selection, we would update that local state,\\nand React Query will automatically trigger the refetch for us, because the query key changes.\\nWe are thus keeping the user's filter selection \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"in sync\"), \" with the query function,\\nwhich is very similar to what a dependency array represents for useEffect.\\nI don't think I have ever passed a variable to the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"queryFn\"), \" that was \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"not\"), \" part of the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"queryKey\"), \", too.\"), mdx(\"h4\", {\n    \"id\": \"a-new-cache-entry\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"A new cache entry\", mdx(\"a\", {\n    parentName: \"h4\",\n    \"href\": \"#a-new-cache-entry\",\n    \"aria-label\": \"a new cache entry permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"Because the query key is used as a key for the cache, you will get a new cache entry when you switch from\\n'all' to 'done', and that will result in a hard loading state (probably showing a loading spinner)\\nwhen you switch for the first time.\\nThis is certainly not ideal, so you can either use the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"keepPreviousData\"), \" option for these cases,\\nor, if possible, pre-fill the newly created cache entry with\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://react-query.tanstack.com/docs/guides/initial-query-data#initial-data-from-cache\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"initialData\"), \".\\nThe above example is perfect for that, because we can do some client side pre-filtering on our todos:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts:title=pre-filtering\",\n    \"metastring\": \"{15-20}\",\n    \"{15-20}\": true\n  }, \"type State = 'all' | 'open' | 'done'\\ntype Todo = {\\n  id: number\\n  state: State\\n}\\ntype Todos = ReadonlyArray<Todo>\\n\\nconst fetchTodos = async (state: State): Promise<Todos> => {\\n  const response = await axios.get(`todos/${state}`)\\n  return response.data\\n}\\n\\nexport const useTodosQuery = (state: State) =>\\n  useQuery(['todos', state], () => fetchTodos(state), {\\n    initialData: () => {\\n      const allTodos = queryCache.getQuery<Todos>(['todos', 'all'])\\n      const filteredData =\\n        allTodos?.filter((todo) => todo.state === state) ?? []\\n\\n      return filteredData.length > 0 ? filteredData : undefined\\n    },\\n  })\\n\")), mdx(\"p\", null, \"Now, every time the user switches between states, if we don't have data yet,\\nwe try to pre-fill it with data from the 'all todos' cache.\\nWe can instantly show the 'done' todos that we have to the user,\\nand they will still see the updated list once the background fetch finishes.\\nPlease note that prior to v3, you would also need to set the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"initialStale\"), \" property to actually trigger a background fetch.\"), mdx(\"p\", null, \"I think this is a great ux improvement for just a few lines of code.\"), mdx(\"h3\", {\n    \"id\": \"keep-server-and-client-state-separate\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Keep server and client state separate\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#keep-server-and-client-state-separate\",\n    \"aria-label\": \"keep server and client state separate permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"This goes hand in hand with \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"./putting-props-to-use-state\"\n  }, \"putting-props-to-use-state\"), \",\\nan article I have written last month:\\nIf you get data from \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"useQuery\"), \", try not to put that data into local state.\\nThe main reason is that you implicitly opt out of all background updates that React Query does for you,\\nbecause the state \\\"copy\\\" will not update with it.\"), mdx(\"p\", null, \"This is fine if you want to e.g. fetch some default values for a Form,\\nand render your Form once you have data.\\nBackground updates are very unlikely to yield something new, and even if, your Form has already been initialized.\\nSo if you do that on purpose, make sure to \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"not\"), \" fire off unnecessary background refetches by setting \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"staleTime\"), \":\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-jsx:title=initial-form-data\"\n  }, \"const App = () => {\\n  const { data } = useQuery('key', queryFn, { staleTime: Infinity })\\n\\n  return data ? <MyForm initialData={data} /> : null\\n}\\n\\nconst MyForm = ({ initialData} ) => {\\n  const [data, setData] = React.useState(initialData)\\n  ...\\n}\\n\")), mdx(\"p\", null, \"This concept will be a bit harder to follow through when you display data that you also want to allow the user to edit,\\nbut it has many advantages.\\nI have prepared a little codesandbox example:\"), mdx(\"iframe\", {\n    src: \"https://codesandbox.io/embed/inspiring-mayer-rp3jx?fontsize=14&hidenavigation=1&theme=dark&view=preview\",\n    style: {\n      \"width\": \"100%\",\n      \"height\": \"600px\",\n      \"border\": \"0\",\n      \"borderRadius\": \"4px\",\n      \"overflow\": \"hidden\"\n    },\n    title: \"separate-server-and-client-state\",\n    allow: \"accelerometer; ambient-light-sensor; camera; encrypted-media; geolocation; gyroscope; hid; microphone; midi; payment; usb; vr; xr-spatial-tracking\",\n    sandbox: \"allow-forms allow-modals allow-popups allow-presentation allow-same-origin allow-scripts\"\n  }), mdx(\"p\", null, \"The important part of this demo is that we never put the value that we get from React Query into local state.\\nThis makes sure that we always see the latest data, because there is no local \\\"copy\\\" of it.\"), mdx(\"h3\", {\n    \"id\": \"the-enabled-option-is-very-powerful\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"The enabled option is very powerful\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#the-enabled-option-is-very-powerful\",\n    \"aria-label\": \"the enabled option is very powerful permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"The \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"useQuery\"), \" hook has many options that you can pass in to customize its behaviour,\\nand the \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"enabled\"), \" option is a very powerful one that \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"enables\"), \" you to do many cool things (pun intended).\\nHere is a short list of things that we were able to accomplish thanks to this option:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://react-query.tanstack.com/docs/guides/queries#dependent-queries\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"Dependent Queries\"), mdx(\"br\", null), \"\\nFetch data in one query and have a second query only run once we have successfully obtained data from the first query.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Turn queries on and off\", mdx(\"br\", null), \"\\nWe have one query that polls data regularly thanks to \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"refetchInterval\"), \", but we can temporarily pause it if a Modal is open to avoid\\nupdates in the back of the screen.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Wait for user input\", mdx(\"br\", null), \"\\nHave some filter criteria in the query key, but disable it for as long as the user has not applied their filters.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Disable a query after some user input\", mdx(\"br\", null), \"\\ne.g. if we then have a draft value that should take precedence over the server data. See the above example.\")), mdx(\"h3\", {\n    \"id\": \"dont-use-the-querycache-as-a-local-state-manager\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Don't use the queryCache as a local state manager\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#dont-use-the-querycache-as-a-local-state-manager\",\n    \"aria-label\": \"dont use the querycache as a local state manager permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"If you tamper with the queryCache (\", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"queryCache.setData\"), \"), it should only be for optimistic updates\\nor for writing data that you receive from the backend after a mutation.\\nRemember that every background refetch might override that data, so\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://reactjs.org/docs/hooks-state.html\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"use\"), \"\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://zustand.surge.sh/\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"something\"), \"\\n\", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://redux.js.org/\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"else\"), \" for local state.\"), mdx(\"h3\", {\n    \"id\": \"create-custom-hooks\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Create custom hooks\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#create-custom-hooks\",\n    \"aria-label\": \"create custom hooks permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"Even if it's only for wrapping one \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"useQuery\"), \" call, creating a custom hook usually pays off because:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"You can keep the actual data fetching out of the ui, but co-located with your \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"useQuery\"), \" call.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"You can keep all usages of one query key (and potentially type definitions) in one file.\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"If you need to tweak some settings or add some data transformation, you can do that in one place.\")), mdx(\"p\", null, \"You have already seen an example of that in the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"#treat-the-query-key-like-a-dependency-array\"\n  }, \"todos queries above\"), \".\"), mdx(Comments, {\n    mdxType: \"Comments\"\n  }, \"I hope that these practical tips will help you getting started with React Query, so go check it out :) If you have any further questions, please let me know in the comments below \\u2B07\\uFE0F\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"#2: React Query Data Transformations #3: React Query Render Optimizations #4: Status Checks in React Query #5: Testing React Query #6: React…","timeToRead":8,"banner":{"childImageSharp":{"resize":{"src":"/static/e34c9bdb709f49c90b76af647160ca18/73f08/react-query.png"}}}}},"pageContext":{"slug":"/practical-react-query","formatString":"DD.MM.YYYY"}},
    "staticQueryHashes": ["2744905544","3090400250","318001574"]}