{
    "componentChunkName": "component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx",
    "path": "/putting-props-to-use-state",
    "result": {"data":{"post":{"slug":"/putting-props-to-use-state","title":"Putting props to useState","date":"25.10.2020","tags":[{"name":"React","slug":"react"},{"name":"useState pitfalls","slug":"use-state-pitfalls"},{"name":"props-to-state","slug":"props-to-state"}],"description":"Part deux of the useState pitfalls series is here, showing patterns to help solve the common use-case of initializing state with a prop.","canonicalUrl":null,"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Putting props to useState\",\n  \"description\": \"Part deux of the useState pitfalls series is here, showing patterns to help solve the common use-case of initializing state with a prop.\",\n  \"date\": \"2020-10-25T00:00:00.000Z\",\n  \"banner\": \"../dont-over-usestate/use-state-pitfalls.png\",\n  \"tags\": [\"React\", \"useState pitfalls\", \"props-to-state\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"span\", {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"64.58333333333334%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACFElEQVQ4y41Ty27TUBD1NyC1oU1tX9txHrWdtE6aOK86bZ4NLwWFRUEtgvCoUAktICEQAiEWSCDEApC6QkhsQAJWfAJrfumgmVsCMkF0MdHN3DPnzjkzVkzTxJ9hGAYHncVCHPr8HAwh5Dkuz79w0VoKZVqSC3QN/uA8ils7MBMJZDunEFwew3ZcGLqOf9VNJRSainShhMLmCOlCgN7rj8gPt5l06eSQOzUta2qXSlQuAbXYLLz1Hmp7j1C8eAPdVx9Q33+M8tV9lC7tQjs+OyGLkkY6tCDUBWTbJ1Dcuo7Oy/doPn2L8s5d1O88Qf/gC8rXbiN/bvtoHRKIhlAbP0RqKX/Y0U0Mv/3gXOPBc5gJW977K2zNfz0kw5NeDsGVPWy8+YTOi3fsZXjvGfoHX5nUWW1C6BorOpKH+lwM6WKZiZzaGgafvyMY3eKh+INNqDPHYFqJvyTT/6lTNoSOZG6Z/fLPXkB19z6TB6Mxst3TvJP0cHQoTEg/5IXQNA6STDk9Po9MqQq30YYWm0Ey58Nr9eXiCyFxQmLlWS68YtlJLFZDuKsteM0NlkUrQz5RbrESwnY8ZIoVZFbKnKf7XO/MBOPU1/lBIlYs24a71oUbtuGGLfYsE9QY7FQbcBsdJFJpeM0+F2ZKFaSWC4wlHE2bHqWtYEKWrKpStqoeytZ+26CqMAzB8iaW6DrfE26SF/Jz/AlJI5cbzynO4QAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"use state pitfalls\",\n    \"title\": \"use state pitfalls\",\n    \"src\": \"/blog/static/3618c6401c627a3352a2218e5567bfab/7d769/use-state-pitfalls.png\",\n    \"srcSet\": [\"/blog/static/3618c6401c627a3352a2218e5567bfab/5243c/use-state-pitfalls.png 240w\", \"/blog/static/3618c6401c627a3352a2218e5567bfab/ab158/use-state-pitfalls.png 480w\", \"/blog/static/3618c6401c627a3352a2218e5567bfab/7d769/use-state-pitfalls.png 960w\", \"/blog/static/3618c6401c627a3352a2218e5567bfab/87339/use-state-pitfalls.png 1440w\", \"/blog/static/3618c6401c627a3352a2218e5567bfab/89fe2/use-state-pitfalls.png 1642w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \"), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"dont-over-use-state\"\n  }, \"#1: Don't over useState\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"b\", null, \"#2: Putting props to useState\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"things-to-know-about-use-state\"\n  }, \"#3: Things to know about useState\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"use-state-for-one-time-initializations\"\n  }, \"#4: useState for one-time initializations\")), mdx(\"li\", {\n    parentName: \"ul\"\n  }, mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"use-state-vs-use-reducer\"\n  }, \"#5: useState vs. useReducer\"))), mdx(Divider, {\n    mdxType: \"Divider\"\n  }), mdx(\"p\", null, \"In the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"dont-over-use-state\"\n  }, \"first part\"), \" of the useState pitfalls series,\\nI talked about avoiding state all together for derived state.\"), mdx(\"p\", null, \"This part is about a common scenario, where we want to initialize our state with values we get as props.\\nThis is something we probably do a lot, and it's not per-se wrong, but it has some potential issues that we need to be aware of.\"), mdx(\"h2\", {\n    \"id\": \"the-example\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"The example\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#the-example\",\n    \"aria-label\": \"the example permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"I will use a classic list / detail use-case as example.\\nWe have a list of persons, and selecting one of them will result in a detail form being filled.\\nWe want to show the persons' email address in the detail form, and also have an apply button that will update that data.\"), mdx(\"p\", null, \"It's an interactive example, so feel free to click around (the code is also editable \\uD83D\\uDE80):\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\",\n    \"metastring\": \"react-live\",\n    \"react-live\": true\n  }, \"const persons = [\\n  {\\n    id: 1,\\n    name: 'Dominik',\\n    email: 'dominik@dorfmeister.cc',\\n  },\\n  {\\n    id: 2,\\n    name: 'John',\\n    email: 'john@doe.com',\\n  },\\n]\\n\\nfunction App() {\\n  const [selected, setSelected] = React.useState(persons[0])\\n\\n  return (\\n    <div>\\n      {persons.map((person) => (\\n        <button\\n          type=\\\"button\\\"\\n          key={person.id}\\n          onClick={() => setSelected(person)}\\n        >\\n          {person.id === selected.id\\n            ? person.name.toUpperCase()\\n            : person.name}\\n        </button>\\n      ))}\\n      <DetailView initialEmail={selected.email} />\\n    </div>\\n  )\\n}\\n\\nfunction DetailView({ initialEmail }) {\\n  const [email, setEmail] = React.useState(initialEmail)\\n\\n  return (\\n    <div>\\n      <input\\n        type=\\\"text\\\"\\n        value={email}\\n        onChange={(event) => setEmail(event.target.value)}\\n      />\\n      <button type=\\\"button\\\" onClick={() => alert(email)}>\\n        Apply\\n      </button>\\n    </div>\\n  )\\n}\\n\\nrender(<App />)\\n\")), mdx(\"h2\", {\n    \"id\": \"usestate-initial-value\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"useState initial value\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#usestate-initial-value\",\n    \"aria-label\": \"usestate initial value permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"You might notice right away that the example is \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"not\"), \" working.\\nYou can edit the email address and click \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Apply\"), \", but if you click on \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"John\"), \", the input field will not update.\"), mdx(\"p\", null, \"As much as React wants us to \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://wattenberger.com/blog/react-hooks\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"think in hooks\"), \" rather than in lifecycles,\\nwhen it comes to state, there is a big difference between the first render (also known as \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"mount\"), \") and further renders\\n(better known as \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"re-renders\"), \").\"), mdx(\"p\", null, \"The initial value of a useState hook is always \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"discarded\"), \" on re-renders - it only has an effect when the component \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"mounts\"), \".\"), mdx(\"p\", null, \"When you click on \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"John\"), \", the DetailView component will be re-rendered (because it already exists on the screen),\\nwhich means that John's email will not be put into our state.\\nBummer, because we still need the local state to edit the email address (to keep the draft changes).\\nWe don't want to update the person Array directly, because we might never click Apply.\"), mdx(\"p\", null, \"I know three ways to handle this and similar use-cases:\"), mdx(\"h2\", {\n    \"id\": \"1-conditionally-render-the-detailview\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"1. Conditionally render the DetailView\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#1-conditionally-render-the-detailview\",\n    \"aria-label\": \"1 conditionally render the detailview permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"We do this a lot when we are using Modals or other components that appear on screen.\"), mdx(\"p\", null, \"Showing the DetailView in a Modal will magically make our code above work, because Modals are usually rendered conditionally.\\nWhen we click on \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"John\"), \", we mount a Modal, thus the useState initial value will be respected.\\nWhen the user closes the Modal, it will be \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"unmounted\"), \", and the next time a person is selected it will be \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"mounted\"), \" again.\"), mdx(\"p\", null, \"Here is how that might look:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\",\n    \"metastring\": \"react-live\",\n    \"react-live\": true\n  }, \"const persons = [\\n  {\\n    id: 1,\\n    name: 'Dominik',\\n    email: 'dominik@dorfmeister.cc',\\n  },\\n  {\\n    id: 2,\\n    name: 'John',\\n    email: 'john@doe.com',\\n  },\\n]\\n\\nfunction App() {\\n  const [selected, setSelected] = React.useState()\\n\\n  const close = () => setSelected(undefined)\\n\\n  return (\\n    <div>\\n      {persons.map((person) => (\\n        <button\\n          type=\\\"button\\\"\\n          key={person.id}\\n          onClick={() => setSelected(person)}\\n        >\\n          {person.name}\\n        </button>\\n      ))}\\n      {selected && (\\n        <div\\n          style={{\\n            position: 'fixed',\\n            top: '0',\\n            left: '0',\\n            paddingTop: '100px',\\n            width: '100%',\\n            height: '100%',\\n            backgroundColor: 'rgba(0,0,0,0.4)',\\n          }}\\n        >\\n          <div\\n            style={{\\n              display: 'flex',\\n              justifyContent: 'center',\\n              width: '80%',\\n              height: '50vh',\\n              margin: 'auto',\\n              backgroundColor: 'white',\\n            }}\\n          >\\n            <DetailView initialEmail={selected.email} close={close} />\\n            <span style={{ cursor: 'pointer' }} onClick={close}>\\n              &times;\\n            </span>\\n          </div>\\n        </div>\\n      )}\\n    </div>\\n  )\\n}\\n\\nfunction DetailView({ initialEmail, close }) {\\n  const [email, setEmail] = React.useState(initialEmail)\\n\\n  return (\\n    <div>\\n      <input\\n        type=\\\"text\\\"\\n        value={email}\\n        onChange={(event) => setEmail(event.target.value)}\\n      />\\n      <button\\n        type=\\\"button\\\"\\n        onClick={() => {\\n          alert(email)\\n          close()\\n        }}\\n      >\\n        Apply\\n      </button>\\n    </div>\\n  )\\n}\\n\\nrender(<App />)\\n\")), mdx(\"p\", null, \"Excuse my css, I suck at this part of web development \\uD83D\\uDE05\"), mdx(\"p\", null, \"But the example works now. That is because the Modal conditionally renders our DetailView, which will make it mount again.\"), mdx(\"p\", null, \"I'm sure many of you have done that a lot, and it's a valid solution.\\nBut be aware that this only works because you are rendering the DetailView in the Modal.\\nIf you want the DetailView to be renderable everywhere, we would need a different solution.\"), mdx(\"h2\", {\n    \"id\": \"2-lifting-state-up\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"2. Lifting state up\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#2-lifting-state-up\",\n    \"aria-label\": \"2 lifting state up permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"You've probably heard this phrase before, the official React docs also have \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://reactjs.org/docs/lifting-state-up.html\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"a section on that topic\"), \".\"), mdx(\"p\", null, \"For this example, it basically just means to take the draft state and move it further up the tree,\\nthus making our DetailView a fully controlled component.\\nSince the DetailView then doesn't need any local state at all, we won't have the problem of putting props into state.\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\",\n    \"metastring\": \"react-live\",\n    \"react-live\": true\n  }, \"const persons = [\\n  {\\n    id: 1,\\n    name: 'Dominik',\\n    email: 'dominik@dorfmeister.cc',\\n  },\\n  {\\n    id: 2,\\n    name: 'John',\\n    email: 'john@doe.com',\\n  },\\n]\\n\\nfunction App() {\\n  const [selected, setSelected] = React.useState(persons[0])\\n  const [email, setEmail] = React.useState(selected.email)\\n\\n  return (\\n    <div>\\n      {persons.map((person) => (\\n        <button\\n          type=\\\"button\\\"\\n          key={person.id}\\n          onClick={() => {\\n            setSelected(person)\\n            setEmail(person.email)\\n          }}\\n        >\\n          {person.id === selected.id\\n            ? person.name.toUpperCase()\\n            : person.name}\\n        </button>\\n      ))}\\n      <DetailView email={email} setEmail={setEmail} />\\n    </div>\\n  )\\n}\\n\\nfunction DetailView({ email, setEmail }) {\\n  return (\\n    <div>\\n      <input\\n        type=\\\"text\\\"\\n        value={email}\\n        onChange={(event) => setEmail(event.target.value)}\\n      />\\n      <button type=\\\"button\\\" onClick={() => alert(email)}>\\n        Apply\\n      </button>\\n    </div>\\n  )\\n}\\n\\nrender(<App />)\\n\")), mdx(\"p\", null, \"Now, the App has full control over all the state, and the DetailView is just a so-called \\\"dumb component\\\".\\nThis approach is feasible for many use-cases, but it's not without drawbacks.\"), mdx(\"p\", null, \"Typing in the input field will now re-render the whole App with every keystroke.\\nWhile this is not a problem for this small example, it might be a problem for bigger Apps.\\nPeople often resort to global state managers because they promise to re-render efficiently.\"), mdx(\"p\", null, \"Once could also argue that the scope of the draft email state is now too big.\\nWhy does the App even care about that, it probably only cares about the new email once the user hits Apply.\"), mdx(\"p\", null, \"The third approach is kind of the middle ground between the two:\\nKeep the same ux and the scope of the draft state small, but still re-mount your form when you need to.\"), mdx(\"h2\", {\n    \"id\": \"3-fully-uncontrolled-with-a-key\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"3. Fully uncontrolled with a key\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#3-fully-uncontrolled-with-a-key\",\n    \"aria-label\": \"3 fully uncontrolled with a key permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-js\",\n    \"metastring\": \"react-live\",\n    \"react-live\": true\n  }, \"const persons = [\\n  {\\n    id: 1,\\n    name: 'Dominik',\\n    email: 'dominik@dorfmeister.cc',\\n  },\\n  {\\n    id: 2,\\n    name: 'John',\\n    email: 'john@doe.com',\\n  },\\n]\\n\\nfunction App() {\\n  const [selected, setSelected] = React.useState(persons[0])\\n\\n  return (\\n    <div>\\n      {persons.map((person) => (\\n        <button\\n          type=\\\"button\\\"\\n          key={person.id}\\n          onClick={() => setSelected(person)}\\n        >\\n          {person.id === selected.id\\n            ? person.name.toUpperCase()\\n            : person.name}\\n        </button>\\n      ))}\\n      <DetailView key={selected.id} initialEmail={selected.email} />\\n    </div>\\n  )\\n}\\n\\nfunction DetailView({ initialEmail }) {\\n  const [email, setEmail] = React.useState(initialEmail)\\n\\n  return (\\n    <div>\\n      <input\\n        type=\\\"text\\\"\\n        value={email}\\n        onChange={(event) => setEmail(event.target.value)}\\n      />\\n      <button type=\\\"button\\\" onClick={() => alert(email)}>\\n        Apply\\n      </button>\\n    </div>\\n  )\\n}\\n\\nrender(<App />)\\n\")), mdx(\"p\", null, \"This is exactly the same code as in the first example, with just one small change:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-diff\"\n  }, \"- <DetailView initialEmail={selected.email} />\\n+ <DetailView key={selected.id} initialEmail={selected.email} />\\n\")), mdx(\"h3\", {\n    \"id\": \"react-keys\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"React keys\", mdx(\"a\", {\n    parentName: \"h3\",\n    \"href\": \"#react-keys\",\n    \"aria-label\": \"react keys permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"The \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"key\"), \" attribute on a React component is a special thing.\\nKeys are mostly used for lists to signalize stability to React,\\nso that the reconciler knows which elements can be re-used, and thus re-rendered.\"), mdx(\"p\", null, \"However, you can also just put a key attribute on any component to tell React:\\n\\\"Please mount this whenever the key changes. As long as the key is the same, please re-render\\\".\"), mdx(\"p\", null, \"This can be seen a little bit like the dependency array in effects.\\nIf it changes, compared to the previous render, React will re-run the \\\"mounting\\\" of the component.\"), mdx(\"p\", null, \"If you want to know more, please read this \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://reactjs.org/docs/reconciliation.html\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"explanation about reconciliation\"), \".\"), mdx(\"h2\", {\n    \"id\": \"the-non-solution\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"The non-solution\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#the-non-solution\",\n    \"aria-label\": \"the non solution permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"You might be tempted to solve the problem with an effect that \\\"syncs\\\" props to state:\"), mdx(\"pre\", null, mdx(\"code\", {\n    parentName: \"pre\",\n    \"className\": \"language-ts:title=syncing-props-and-state\"\n  }, \"function DetailView({ initialEmail }) {\\n    const [email, setEmail] = React.useState(initialEmail)\\n\\n    React.useEffect(() => {\\n        setEmail(initialEmail)\\n    }, [initialEmail])\\n\\n    return (...)\\n}\\n\\n\")), mdx(\"p\", null, \"I would consider effects like these generally an anti-pattern.\\nIf effects are used for syncing, they should be used to sync React state with something \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"outside\"), \" of React, e.g. with localstorage.\"), mdx(\"p\", null, \"But here, we are syncing something that already lives inside React with React state.\\nFurther, the condition on which we sync does not really reflect what we want to achieve:\\nWe want to reset the state whenever another person is selected, \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"not\"), \" necessarily when the email changes.\"), mdx(\"p\", null, \"The first solution does this via conditional rendering,\\nthe second one by setting the state explicitly when the button that selects a person is clicked,\\nand the third one by providing a stable key (the selected persons' id).\"), mdx(\"p\", null, \"Emails might be a suboptimal example, because they are generally also unique,\\nbut what if two persons have the same data (e.g. a firstName)?\\nThe effect won't re-run, even though we click on a different person, and thus the draft state is not reset.\"), mdx(\"p\", null, \"Similarly, what if the data changes in the parent component\\n(e.g. because of a re-fetch by \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://react-query.tanstack.com/docs/guides/window-focus-refetching\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"react-query\"), \"),\\nbut our user has already changed the value in the input field?\\nWould we really want to override the user input in these cases?\"), mdx(\"p\", null, \"So, effects like these open you up to a bunch of hard-to-track errors in corner cases that you'd better avoid.\"), mdx(\"h2\", {\n    \"id\": \"takeaways\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Takeaways\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#takeaways\",\n    \"aria-label\": \"takeaways permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"Personally, I don't have a preferred solution. I have used all three approaches occasionally.\"), mdx(\"p\", null, \"The detail view owning the draft state has some advantages, but unmounting comes with a bit of a cost,\\nand you don't always have a stable key or a clear indication when a component should be reset.\"), mdx(\"p\", null, \"Lifting state up also has advantages, as fully controlled components are usually easier to reason about,\\nbut it might not always be easily doable in large applications.\"), mdx(\"p\", null, \"Whatever you decide, please, don't use the syncing state \\\"solution\\\".\\nTo me, this approach is similar to the old \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"componentWillReceiveProps\"), \" lifecycle, which was also used to sync props with state.\\nI don't recall that ending well. \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://reactjs.org/blog/2018/06/07/you-probably-dont-need-derived-state.html\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"Here\"), \"\\nis a very good article from 2018 by \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://twitter.com/brian_d_vaughn\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"Brian Vaughn\"), \" on that anti-pattern,\\nwhich also heavily inspired this article.\"), mdx(Comments, {\n    mdxType: \"Comments\"\n  }, \"Which solution do you prefer? leave a comment below \\u2B07\\uFE0F\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"#1: Don't over useState #3: Things to know about useState #4: useState for one-time initializations #5: useState vs. useReducer In theâ€¦","timeToRead":5,"banner":{"childImageSharp":{"resize":{"src":"/static/3618c6401c627a3352a2218e5567bfab/73f08/use-state-pitfalls.png"}}}}},"pageContext":{"slug":"/putting-props-to-use-state","formatString":"DD.MM.YYYY"}},
    "staticQueryHashes": ["2744905544","3090400250","318001574"]}