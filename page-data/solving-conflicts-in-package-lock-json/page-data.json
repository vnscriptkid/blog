{
    "componentChunkName": "component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx",
    "path": "/solving-conflicts-in-package-lock-json",
    "result": {"data":{"post":{"slug":"/solving-conflicts-in-package-lock-json","title":"Solving conflicts in package-lock.json","date":"02.09.2020","tags":[{"name":"npm","slug":"npm"},{"name":"package-lock.json","slug":"package-lock-json"}],"description":"Why you should never delete package-lock.json and how npm can solve the conflicts for you","canonicalUrl":null,"body":"var _excluded = [\"components\"];\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Solving conflicts in package-lock.json\",\n  \"description\": \"Why you should never delete package-lock.json and how npm can solve the conflicts for you\",\n  \"date\": \"2020-09-02T00:00:00.000Z\",\n  \"banner\": \"./lock.jpg\",\n  \"tags\": [\"npm\", \"package-lock.json\"]\n};\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, _excluded);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"span\", {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"640px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"66.66666666666666%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAANABQDASIAAhEBAxEB/8QAGAAAAgMAAAAAAAAAAAAAAAAAAAUBAwT/xAAWAQEBAQAAAAAAAAAAAAAAAAACAAH/2gAMAwEAAhADEAAAAWCessgziP8A/8QAGhAAAwADAQAAAAAAAAAAAAAAAQIDABESIf/aAAgBAQABBQJrAyep66yLbD+jP//EABURAQEAAAAAAAAAAAAAAAAAAAAR/9oACAEDAQE/Aar/xAAVEQEBAAAAAAAAAAAAAAAAAAAAEf/aAAgBAgEBPwGI/8QAGhAAAgIDAAAAAAAAAAAAAAAAEBEAAQJBYf/aAAgBAQAGPwJx6F48P//EABwQAAICAgMAAAAAAAAAAAAAAAERADEhQVFhkf/aAAgBAQABPyFEHrEYDtxcF8m4bRFvICzTxCESHP/aAAwDAQACAAMAAAAQ1+//xAAXEQADAQAAAAAAAAAAAAAAAAAAAREh/9oACAEDAQE/EFSwo//EABcRAAMBAAAAAAAAAAAAAAAAAAABIRH/2gAIAQIBAT8QdUwf/8QAHhABAAICAQUAAAAAAAAAAAAAAQARITFBUXGBocH/2gAIAQEAAT8QeXqfJM2NyuQXT2mfWWlPESDkW6OQ/JotVVHuMYsM/9k=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"lock\",\n    \"title\": \"lock\",\n    \"src\": \"/blog/static/58fe8a189a1d74270e237a02f438f2a9/bbe0c/lock.jpg\",\n    \"srcSet\": [\"/blog/static/58fe8a189a1d74270e237a02f438f2a9/46946/lock.jpg 240w\", \"/blog/static/58fe8a189a1d74270e237a02f438f2a9/55489/lock.jpg 480w\", \"/blog/static/58fe8a189a1d74270e237a02f438f2a9/bbe0c/lock.jpg 640w\"],\n    \"sizes\": \"(max-width: 640px) 100vw, 640px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \"), mdx(Attribution, {\n    name: \"James Sutton\",\n    url: \"https://unsplash.com/@jamessutton_photography\",\n    mdxType: \"Attribution\"\n  }), mdx(\"p\", null, \"I wish I wouldn't spend as much time solving git conflicts as I currently am.\"), mdx(\"p\", null, \"It's cumbersome. It's error-prone. It is just not fun.\"), mdx(\"p\", null, \"One thing that can be costly when done wrong is solving conflicts in generated files, like package-lock.json.\\nIt usually happens when two branches add or update a dependency.\\nThe result of package-lock then changes, and whoever gets their PR merged to main first is the lucky one who avoided those conflicts.\\nIt's almost like a race.\"), mdx(\"p\", null, \"So here you are, updating your PR with the base branch, and git shows you this huge amount of conflicts in package-lock.json.\\nThe conflicts in package.json are usually easily solved (if there even are any), so I think it is tempting to just \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"delete\"), \" package-lock.json and run \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm install\"), \".\\nAfter all, this will give you a brand new package-lock.json, which you can happily commit.\"), mdx(\"h2\", {\n    \"id\": \"why-you-should-never-delete-package-lockjson\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"Why you should never delete package-lock.json\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#why-you-should-never-delete-package-lockjson\",\n    \"aria-label\": \"why you should never delete package lockjson permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"When you install a dependency for the first time, it is usually automatically added to your dependencies or devDependencies with \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"^version\"), \",\\nwhich means \\\"compatible with version, according to \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://semver.org/\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"semver\"), \"\\\".\\nYou can try out what that means \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://semver.npmjs.com/\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"here\"), \".\"), mdx(\"p\", null, \"Enter, for example, \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"lodash\"), \" as the package and \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"^4.2.1\"), \" as version,\\nand you will see that you can get \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"anything\"), \" from 4.2.1 to 4.17.20 (the latest version)\"), mdx(\"span\", {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }, \"\\n      \", mdx(\"span\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"52.083333333333336%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaklEQVQoz5WSCU/CQBCF+f+/SCNHqiConCEeMUQUjfbuttDtHm2f2aEFGzXGTSb7dmby7dtpW0IIpGkKs9c6yzKYVZYlxX9WS2sNKSWFUmofWjWANfRPXQItI4wj487sRVH8ePNXp79qlGgZUbs0S2gBO3OoMS9yvPMPiFxQzeS3ekfaFR6YiklHktGZHJoE5xxBGOyLgqHt9JCXObjiOLHb8KRPzWd2F+v0hfouvEvcJvekx8EUXddqAn3fPwA7rnUAnrod+DKgZnPRmldAf4gJm5FO9BaRYkegmV8NjGWMvjdEXhbIVIaee45AhlQ7dwfY8FfSV8EYM7ZozrmeoQGymFXABAN/RA7NPC1vgFBFVOv7I2z4G+mbcIo5W5IuyuL4lU0i5Sm8wKueHKHrWOSQnmwfn9xxLDzzzR7uDXEdTppAVEAmGFbJEyV2aocFW1KT1BLTaI5YJwQ0eUe41HeXPOBxt/r2T34CefUDXLPLla4AAAAASUVORK5CYII=')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  }), \"\\n  \", mdx(\"img\", {\n    parentName: \"span\",\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"semver calc\",\n    \"title\": \"semver calc\",\n    \"src\": \"/blog/static/cf9aa3c894a1e23145569af37395ab80/7d769/semver-calc.png\",\n    \"srcSet\": [\"/blog/static/cf9aa3c894a1e23145569af37395ab80/5243c/semver-calc.png 240w\", \"/blog/static/cf9aa3c894a1e23145569af37395ab80/ab158/semver-calc.png 480w\", \"/blog/static/cf9aa3c894a1e23145569af37395ab80/7d769/semver-calc.png 960w\", \"/blog/static/cf9aa3c894a1e23145569af37395ab80/9d8f4/semver-calc.png 973w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\",\n    \"decoding\": \"async\"\n  }), \"\\n    \"), mdx(\"p\", null, \"This is where package-lock.json comes into play. Upon installing, it will \\\"lock\\\" you in on the version that you just installed.\\nSo if 4.2.1 is the latest version at the moment of your install, \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"this version\"), \" will be written to package-lock and will, from there on, always be installed.\\nEven if newer versions come out that are theoretically compatible with it.\"), mdx(\"p\", null, \"This is important because it guarantees that every developer in the team will have the same version on their machine, and it is equally important for CI/CD.\\nI would not want to ship a \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"newer\"), \" version to production than we tested with, even if it's just a patch version.\"), mdx(\"p\", null, \"So when you delete package-lock.json, all those consistency goes out the window.\\nEvery node_module you depend on will be updated to the latest version it is theoretically compatible with.\\nThis means no major changes, but minors and patches. I believe this is bad for three reasons:\"), mdx(\"ol\", null, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"It trusts that everyone strictly adheres to semantic versioning, and I sincerely doubt that this is the case. There is also no way to enforce this.\"), mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"Major version zero is exempt from the rules of semantic versioning. From \", mdx(\"a\", {\n    parentName: \"li\",\n    \"href\": \"https://semver.org/#spec-item-4\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"the semver spec\"), \":\", mdx(\"blockquote\", {\n    parentName: \"li\"\n  }, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Major version zero (0.y.z) is for initial development. Anything MAY change at any time. The public API SHOULD NOT be considered stable.\")))), mdx(\"p\", null, \"Have a look at your package-lock.json and count how many dependencies with major version 0 you have.\\nFor this blog (made with \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://www.gatsbyjs.com/\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"gatsby\"), \") I have 362!\"), mdx(\"ol\", {\n    \"start\": 3\n  }, mdx(\"li\", {\n    parentName: \"ol\"\n  }, \"This \", mdx(\"em\", {\n    parentName: \"li\"\n  }, \"also\"), \" applies to transitive dependencies. So even if you are using strict versions (without the \", mdx(\"inlineCode\", {\n    parentName: \"li\"\n  }, \"^\"), \"), the libraries you are using do not.\")), mdx(\"p\", null, \"If you delete package-lock.json now from any one of your projects and run \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"npm install\"), \" again, it will most certainly look completely different.\"), mdx(\"p\", null, \"Will your app be fine? Maybe, maybe not. No one can tell.\\nFor me, this would usually mean: \\\"regression test everything\\\", which is certainly not what I have in mind when I am just solving a conflict.\"), mdx(\"h2\", {\n    \"id\": \"what-you-can-do-instead\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, \"What you can do instead\", mdx(\"a\", {\n    parentName: \"h2\",\n    \"href\": \"#what-you-can-do-instead\",\n    \"aria-label\": \"what you can do instead permalink\",\n    \"className\": \"anchor after\"\n  }, mdx(\"svg\", {\n    parentName: \"a\",\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }, mdx(\"path\", {\n    parentName: \"svg\",\n    \"fill\": \"currentcolor\",\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), mdx(\"p\", null, \"My usual approach was the following:\"), mdx(\"ul\", null, mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Solve the conflicts in package.json\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"Take package-lock.json from the base branch\"), mdx(\"li\", {\n    parentName: \"ul\"\n  }, \"run npm install again\")), mdx(\"p\", null, \"This will then just re-install whatever changes we made in our branch.\\nHowever, I recently learned about and even easier way:\"), mdx(\"p\", null, \"npm can automatically detect conflicts in package-lock.json and resolve them for us.\\nFrom the \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"https://docs.npmjs.com/files/package-locks.html#resolving-lockfile-conflicts\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"npm docs\"), \":\"), mdx(\"blockquote\", null, mdx(\"p\", {\n    parentName: \"blockquote\"\n  }, \"Occasionally, two separate npm install will create package locks that cause merge conflicts in source control systems. As of \", mdx(\"a\", {\n    parentName: \"p\",\n    \"href\": \"mailto:npm@5.7.0\",\n    \"target\": \"_blank\",\n    \"rel\": \"noreferrer noopener\"\n  }, \"npm@5.7.0\"), \", these conflicts can be resolved by manually fixing any package.json conflicts, and then running npm install \", \"[--package-lock-only]\", \" again. npm will automatically resolve any conflicts for you and write a merged package lock that includes all the dependencies from both branches in a reasonable tree. If --package-lock-only is provided, it will do this without also modifying your local node_modules/.\")), mdx(\"p\", null, \"This means that we can just keep the conflicts in the lock file.\\nAll we have to do is get package.json right, and npm will do the rest for us \\uD83C\\uDF89.\"), mdx(\"p\", null, \"I wish I had known this sooner - it would've saved me some trouble.\"), mdx(Comments, {\n    mdxType: \"Comments\"\n  }, \"Agree? Disagree? Let me know in the comments below \\u2B07\\uFE0F\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"I wish I wouldn't spend as much time solving git conflicts as I currently am. It's cumbersome. It's error-prone. It is just not fun. One…","timeToRead":3,"banner":{"childImageSharp":{"resize":{"src":"/static/58fe8a189a1d74270e237a02f438f2a9/a6c62/lock.jpg"}}}}},"pageContext":{"slug":"/solving-conflicts-in-package-lock-json","formatString":"DD.MM.YYYY"}},
    "staticQueryHashes": ["2744905544","3090400250","318001574"]}